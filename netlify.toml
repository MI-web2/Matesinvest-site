[build]
  command = "node generate-stock-pages.js"
  publish = "."

[functions]
  directory = "netlify/functions"
  included_files = [
    "netlify/functions/asx200.txt",
    "netlify/functions/asx-universe.txt"
  ]
  node_bundler = "esbuild"

[functions."snapshot-metals"]
  schedule = "0 19 * * *"

[functions."snapshot-mcaps"]
  schedule = "0 20 * * *"

[functions."snapshot-asx200"]
  # Run once a day at 20:00 UTC (~6am AEST / 7am AEDT)
  schedule = "0 20 * * *"

[functions."generate-morning-note"]
  # Runs at 20:02 UTC, ~7:02am Australia/Sydney
  # but we label the note as "generatedAt" 6:00am AEST/AEDT
  schedule = "2 20 * * *"

[functions."email-daily-brief"]
  # Run email-daily-brief Mon–Fri at 06:05 AEST
  # (which is Sun–Thu 20:05 UTC)
  schedule = "5 20 * * 0-4"
  
[functions."email-weekly-brief"]
  # Weekly brief: Sat 06:05 AEST (Fri 20:05 UTC)
  schedule = "5 20 * * 5"
  
[functions."snapshot-crypto"]
  # Crypto snapshot daily at 20:00 UTC (~6am AEST / 7am AEDT)
  # Used by morning-brief + daily email for BTC/ETH/SOL/ADA
  schedule = "0 20 * * *"
  
[functions."snapshot-asx200-fundamentals"]
  # run overnight Mon–Fri AEST-ish
  schedule = "30 21 * * 1-5"

[functions."snapshot-asx-universe"]
  # Run repeatedly overnight in batches. This fires every 2 minutes between 11:00–23:59 UTC
  # Each invocation processes one batch (reads offset from Upstash, writes part:<offset>, updates offset).
  # Adjust the hour range or frequency if you prefer a different window.
  schedule = "*/2 11-23 * * *"

[functions."snapshot-asx-universe-prices"]
  # Run repeatedly overnight in the same window (every 2 minutes between 11:00–23:59 UTC)
  schedule = "*/2 11-23 * * *"
  
  # Merge job: run shortly after snapshot window ends so all parts are expected to be written.
# Runs daily at 00:05 UTC; second run at 02:05 UTC as a fallback.
[functions."merge-asx-universe"]
  schedule = "5 0,2 * * *"

[[redirects]]
  from = "/content/articles"
  to = "/content-index.html"
  status = 200

[[redirects]]
  from = "/content/*"
  to = "/content.html"
  status = 200
  
[[redirects]]
  from = "/mates-summaries.html"
  to = "/"
  status = 301
  force = true

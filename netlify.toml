[build]
  command = "node generate-stock-pages.js"
  publish = "."

[functions]
  directory = "netlify/functions"
  included_files = [
    "netlify/functions/asx200.txt",
    "netlify/functions/asx-universe.txt",
    "netlify/functions/au-macro-key-dates-2026.txt"
  ]
  node_bundler = "esbuild"

[functions."snapshot-metals"]
  schedule = "0 19 * * *"

[functions."snapshot-mcaps"]
  schedule = "0 20 * * *"

[functions."snapshot-asx200"]
  # Run once a day at 20:00 UTC (~6am AEST / 7am AEDT)
  schedule = "0 20 * * *"

[functions."generate-morning-note"]
  # Runs at 20:02 UTC, ~7:02am Australia/Sydney
  # but we label the note as "generatedAt" 6:00am AEST/AEDT
  schedule = "2 20 * * *"

[functions."email-daily-brief"]
  # Standard daily brief: Wed & Fri at 06:05 AEST
  # (which is Tue & Thu 20:05 UTC)
  schedule = "5 20 * * 2,4"

[functions."email-daily-brief-quiz"]
  # Quiz version: Tue & Thu at 06:05 AEST
  # (which is Mon & Wed 20:05 UTC)
  schedule = "5 20 * * 1,3"

[functions."email-weekly-brief"]
  # Weekly brief: Sat 06:05 AEST (Fri 20:05 UTC)
  schedule = "5 20 * * 5"

[functions."snapshot-crypto"]
  # Crypto snapshot daily at 20:00 UTC (~6am AEST / 7am AEDT)
  # Used by morning-brief + daily email for BTC/ETH/SOL/ADA
  schedule = "0 20 * * *"

[functions."snapshot-asx200-fundamentals"]
  # run overnight Mon–Fri AEST-ish
  schedule = "30 21 * * 1-5"

[functions."snapshot-asx-universe"]
  # Run repeatedly overnight in batches. This fires every 2 minutes between 11:00–23:59 UTC
  # Each invocation processes one batch (reads offset from Upstash, writes part:<offset>, updates offset).
  # Adjust the hour range or frequency if you prefer a different window.
  schedule = "*/2 11-23 * * *"

[functions."snapshot-asx-universe-prices"]
  # Run repeatedly overnight in the same window (every 2 minutes between 11:00–23:59 UTC)
  schedule = "*/2 11-23 * * *"

# Merge job: run shortly after snapshot window ends so all parts are expected to be written.
# Runs daily at 00:05 UTC; second run at 02:05 UTC as a fallback.
[functions."merge-asx-universe"]
  schedule = "5 0,2 * * *"

# ✅ NEW: Daily analytics email summary at 05:00 AEST (19:00 UTC)
[functions."email-analytics-summary"]
  schedule = "0 19 * * *"

[functions."email-week-ahead"]
  # Week Ahead email: Monday 06:05 AEST (Sunday 20:05 UTC)
  schedule = "5 20 * * 0"
[functions."market-pulse"]
  # Daily ASX Market Pulse
  # Runs at 06:10 AEST (20:10 UTC previous day)
  # Calculates ASX 200 (internal), breadth, turnover, movers
  # Runs daily to keep data fresh even on weekends
  schedule = "10 20 * * *"
  
  [functions."market-pulse-window-cache"]
  # Runs daily to keep window caches fresh
  schedule = "15 20 * * *"

  [functions."build-sectors-day"]
  # Build daily ASX sector snapshots
  # Runs AFTER universe merge, BEFORE market-pulse readers
  # 20:00 UTC ≈ 6:00am AEST / 7:00am AEDT
  # Runs daily to keep sector data fresh
  schedule = "0 20 * * *"

[[redirects]]
  from = "/content/articles"
  to = "/content-index.html"
  status = 200

[[redirects]]
  from = "/content/*"
  to = "/content.html"
  status = 200

[[redirects]]
  from = "/mates-summaries"
  to = "/"
  status = 301
  force = true

  [[redirects]]
  from = "/mates-summaries.html"
  to = "/"
  status = 301
  force = true
  
  [[redirects]]
  from = "/how-to-think"
  to = "/how-you-think"
  status = 301


[build.environment]
  NODE_VERSION = "20"

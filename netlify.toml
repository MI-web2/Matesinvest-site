[build]
  command = "node generate-stock-pages.js"
  publish = "."

[functions]
  directory = "netlify/functions"
  included_files = [
    "netlify/functions/asx200.txt",
    "netlify/functions/asx-universe.txt",
    "netlify/functions/au-macro-key-dates-2026.txt"
  ]
  node_bundler = "esbuild"

[functions."snapshot-metals"]
  schedule = "0 19 * * *"

[functions."snapshot-mcaps"]
  schedule = "0 20 * * *"

[functions."snapshot-asx200"]
  # Run once a day at 20:00 UTC (~6am AEST / 7am AEDT)
  schedule = "0 20 * * *"

[functions."generate-morning-note"]
  # Runs at 20:02 UTC, ~7:02am Australia/Sydney
  # but we label the note as "generatedAt" 6:00am AEST/AEDT
  schedule = "2 20 * * *"

[functions."email-daily-brief"]
  # Standard daily brief: Wed & Fri at 06:05 AEST
  # (which is Tue & Thu 20:05 UTC)
  schedule = "5 20 * * 2,4"

[functions."email-daily-brief-quiz"]
  # Quiz version: Tue & Thu at 06:05 AEST
  # (which is Mon & Wed 20:05 UTC)
  schedule = "5 20 * * 1,3"

  [functions."snapshot-vix-proxy"]
  schedule = "15 20 * * *"

[functions."email-weekly-brief"]
  # Weekly brief: Sat 06:05 AEST (Fri 20:05 UTC)
  schedule = "5 20 * * 5"

[functions."snapshot-crypto"]
  # Crypto snapshot daily at 20:00 UTC (~6am AEST / 7am AEDT)
  # Used by morning-brief + daily email for BTC/ETH/SOL/ADA
  schedule = "0 20 * * *"

[functions."snapshot-asx200-fundamentals"]
  # run overnight Mon–Fri AEST-ish
  schedule = "30 21 * * 1-5"

[functions."snapshot-asx-universe"]
  # Run repeatedly overnight in batches. This fires every 2 minutes between 11:00–23:59 UTC
  # Each invocation processes one batch (reads offset from Upstash, writes part:<offset>, updates offset).
  # Adjust the hour range or frequency if you prefer a different window.
  schedule = "*/2 11-23 * * *"

[functions."snapshot-asx-universe-prices"]
  # Run after ASX closes (4pm AEST/AEDT) and after EODHD updates EOD data
  # EODHD typically updates within 2-3 hours of market close
  # Run ONCE per day at a fixed time to avoid overwriting the same date's snapshot
  # 12:00 UTC = 10:00pm AEST / 11:00pm AEDT (well after market close, after EODHD updates)
  schedule = "0 12 * * *"

# Merge job: run shortly after snapshot window ends so all parts are expected to be written.
# Runs daily at 00:05 UTC; second run at 02:05 UTC as a fallback.
[functions."merge-asx-universe"]
  schedule = "5 0,2 * * *"

# ✅ NEW: Daily analytics email summary at 05:00 AEST (19:00 UTC)
[functions."email-analytics-summary"]
  schedule = "0 19 * * *"

[functions."email-week-ahead"]
  # Week Ahead email: Monday 06:05 AEST (Sunday 20:05 UTC)
  schedule = "5 20 * * 0"
[functions."market-pulse"]
  # Daily ASX Market Pulse
  # Runs at 06:12 AEST (20:12 UTC previous day)
  # Runs AFTER build-sectors-day completes (20:05)
  # Calculates ASX 200 (internal), breadth, turnover, movers
  # Runs daily to keep data fresh even on weekends
  schedule = "12 20 * * *"
  
  [functions."market-pulse-window-cache"]
  # Runs AFTER market-pulse completes (20:12)
  # Builds 1D/5D/1M window caches for fast UI reads
  # Runs daily to keep window caches fresh
  schedule = "18 20 * * *"

  [functions."build-sectors-day"]
  # Build daily ASX sector snapshots
  # Runs AFTER universe merge (02:05 UTC), BEFORE market-pulse
  # 20:05 UTC ≈ 6:05am AEST / 7:05am AEDT
  # Runs daily to keep sector data fresh
  schedule = "5 20 * * *"

[[redirects]]
  from = "/content/articles"
  to = "/content-index.html"
  status = 200

[[redirects]]
  from = "/content/*"
  to = "/content.html"
  status = 200

[[redirects]]
  from = "/mates-summaries"
  to = "/"
  status = 301
  force = true

  [[redirects]]
  from = "/mates-summaries.html"
  to = "/"
  status = 301
  force = true
  
  [[redirects]]
  from = "/how-to-think"
  to = "/how-you-think"
  status = 301

  [[redirects]]
  from = "/equity-screener"
  to = "/discover"
  status = 301

[[redirects]]
  from = "/equity-screener.html"
  to = "/discover"
  status = 301


[build.environment]
  NODE_VERSION = "20"

function renderSummary(s) {
  // New fields from backend
  const oneLiner = s.oneLiner || s.whatsHappening || "";  // fallback to old field if needed
  const tldrBullets = Array.isArray(s.tldrBullets) ? s.tldrBullets : [];
  const keyMetrics = Array.isArray(s.keyMetrics) ? s.keyMetrics : [];

  const tldrHtml = tldrBullets.map(b => `<li>${b}</li>`).join("");
  let metricsHtml = keyMetrics.map(b => `<li>${b}</li>`).join("");

  // Backwards-compatibility fallback: if no keyMetrics but we still have old fields
  if (!keyMetrics.length && (s.whatsHappening || s.whyItMatters)) {
    const fallbacks = [];
    if (s.whatsHappening) fallbacks.push(`Context: ${s.whatsHappening}`);
    if (s.whyItMatters) fallbacks.push(`Impact: ${s.whyItMatters}`);
    metricsHtml = fallbacks.map(b => `<li>${b}</li>`).join("");
  }

  const riskNote = s.riskNote || "";
  const disclaimer = s.disclaimer || "General information only, not financial advice.";

  return `
    <div class="summary-block">
      ${oneLiner ? `<p><strong>${oneLiner}</strong></p>` : ""}

      ${tldrBullets.length ? `
        <p><strong>TL;DR</strong></p>
        <ul>${tldrHtml}</ul>
      ` : ""}

      ${metricsHtml ? `
        <p><strong>Key metrics / details</strong></p>
        <ul>${metricsHtml}</ul>
      ` : ""}

      ${riskNote ? `
        <p><strong>Risks / uncertainty:</strong> ${riskNote}</p>
      ` : ""}

      <small>${disclaimer}</small>
    </div>
  `;
}
